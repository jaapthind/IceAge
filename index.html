<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Glass OS // Physics Engine</title>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { 
            background: #000; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            perspective: 1000px;
        }

        /* --- THE SMOOTH RENDERER --- */
        #physics-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            /* Optimized filter: No blur in the CSS to prevent lag */
            filter: url(#molten-glass-filter);
            background: linear-gradient(to bottom, #050505, #111);
        }

        #interface {
            display: flex;
            gap: 30px;
            z-index: 10;
            pointer-events: none; /* Allows window "shaking" without clicking UI */
        }

        .panel {
            pointer-events: auto;
            background: var(--glass);
            border: 1px solid var(--border);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        #controls { width: 300px; padding: 25px; color: white; }
        #chat { width: 400px; height: 550px; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; opacity: 0.9; }

        h2 { font-size: 10px; letter-spacing: 3px; margin-bottom: 20px; opacity: 0.6; }
        .stat { font-family: monospace; font-size: 10px; color: #0f0; margin-top: 10px; }

        #boot {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn {
            padding: 15px 40px; background: #fff; color: #000; border-radius: 50px;
            font-weight: 900; border: none; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="boot">
        <h1 style="color:white; margin-bottom: 20px; letter-spacing: 5px;">KINETIC_GLASS_V8</h1>
        <button class="btn" onclick="init()">GRANT PERMISSIONS & START</button>
    </div>

    <svg style="position: absolute; width: 0; height: 0;">
        <filter id="molten-glass-filter">
            <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="2" result="noise" />
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="80" xChannelSelector="R" yChannelSelector="G" />
        </filter>
    </svg>

    <canvas id="physics-canvas"></canvas>
    <video id="webcam" style="display:none" autoplay playsinline></video>

    <div id="interface">
        <div class="panel" id="controls">
            <h2>PHYSICS_ENGINE_SENSORS</h2>
            <p style="font-size: 11px; opacity: 0.8;">The liquid now reacts to window movement and gravity.</p>
            <div class="stat" id="momentum-ui">MOMENTUM: 0.0</div>
            <div class="stat" id="gravity-ui">GRAVITY: ACTIVE</div>
            <div style="margin-top: 20px;">
                <label style="font-size: 10px;">VISCOSITY</label>
                <input type="range" style="width:100%" id="visc" min="0.8" max="0.99" step="0.01" value="0.95">
            </div>
        </div>

        <div class="panel" id="chat">
            <iframe src="https://deadsimplechat.com/J4fFLy4Ek"></iframe>
        </div>
    </div>

<script>
    const canvas = document.getElementById('physics-canvas');
    const ctx = canvas.getContext('2d');
    const video = document.getElementById('webcam');
    
    let blobs = [];
    let lastWinX = window.screenX;
    let lastWinY = window.screenY;
    let winVelocityX = 0;
    let winVelocityY = 0;

    async function init() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;
        document.getElementById('boot').remove();
        
        resize();
        // Create 12 Liquid Blobs
        for(let i=0; i<12; i++) {
            blobs.push({
                x: Math.random() * canvas.width,
                y: canvas.height - 100,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                radius: 150 + Math.random() * 150,
                hue: Math.random() * 360
            });
        }
        loop();
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.onresize = resize;

    function loop() {
        ctx.fillStyle = 'rgba(0,0,0,0.1)'; // Slight trail
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 1. WINDOW SHAKE MOMENTUM
        winVelocityX = (window.screenX - lastWinX) * 0.5;
        winVelocityY = (window.screenY - lastWinY) * 0.5;
        lastWinX = window.screenX;
        lastWinY = window.screenY;

        const friction = parseFloat(document.getElementById('visc').value);
        const gravity = 0.5;

        document.getElementById('momentum-ui').innerText = `MOMENTUM: ${Math.abs(winVelocityX + winVelocityY).toFixed(2)}`;

        blobs.forEach(b => {
            // Apply Momentum from window shaking
            b.vx -= winVelocityX;
            b.vy -= winVelocityY;

            // Physics
            b.vy += gravity; // Constant gravity pulling down
            b.x += b.vx;
            b.y += b.vy;
            b.vx *= friction;
            b.vy *= friction;

            // Bounce off bottom and sides
            if (b.y + b.radius/2 > canvas.height) {
                b.y = canvas.height - b.radius/2;
                b.vy *= -0.6; // Bounce elasticity
            }
            if (b.x - b.radius/2 < 0 || b.x + b.radius/2 > canvas.width) {
                b.vx *= -0.8;
            }

            // Draw Webcam Blobs
            ctx.save();
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
            ctx.clip();
            
            // The Molten Rainbow look
            b.hue = (b.hue + 1) % 360;
            ctx.filter = `hue-rotate(${b.hue}deg) brightness(1.2) saturate(1.8)`;
            
            // Mirror image draw
            ctx.translate(b.x + b.radius, b.y - b.radius);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, b.radius*2, b.radius*2);
            ctx.restore();
        });

        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
